# 2026-01-05 Meeting

### Meeting Agenda

**Time:** 9am Monday San Diego time
- company update, release!
- new year sprints
- assembly
- LLaMA, flash attention
- use claude to clean up stuff
- viz / fast gemm
- drivers
- image dtype
- other bounties

### Audio

[Youtube Link](https://www.youtube.com/watch?v=GNdNtguh1zo)

### Highlights

- **[Company update: 2026 is the year to get Tinygrad users (and maybe 1.0)](#geohot-000008)**: Notes 5090s “cost $5,000,” backlog progress, and argues Tinygrad’s small/simple codebase is a compounding advantage—focus on usability, good error messages, and using LLM agents to find edge cases so Tinygrad is more usable for both humans and agents.
- **[LLM cleanup reality check: “Claude has no taste”](#geohot-000221)**: Chenyu reports mixed results from asking Claude to “clean every part of Tinygrad”; Geohot’s takeaway is that LLMs can help, but taste/judgment still matters.
- **[New Year’s release this week; decide on version 0.12](#chenyu-000314)**: Team aligns on doing a release, settles on “0.12,” and notes it’s been about six months since the last release.
- **[Two-week sprint cadence + self-accountability check-ins](#geohot-000334)**: Proposes a Discord bot prompt every two weeks for everyone to post a short plan; emphasizes planning on a two-week horizon as a differentiator vs current AI agents.
- **[AsmDSL: make assembly usable via a Python “IDE” experience](#geohot-000506)**: Describes the Python assembly DSL benefits (semantic register names, type checks, better errors, Python for-loops), plus autogenerated instruction bindings parsed from AMD PDFs.
- **[AsmDSL as a key Tinygrad piece + immediate perf wins](#geohot-000800)**: Frames AsmDSL as reducing reliance on LLVM-like tooling for high-perf kernels and mentions beating SebV FP32 GEMM by ~5% through clearer syntax enabling better cleanup.
- **[RDNA4 fast GEMM progress + occupancy discussion](#qazalin-000919)**: Qazalin reports a ~700-line Python DSL kernel hitting ~70% on their machine; they discuss pipelining, wave usage, VGPR pressure, and profiling via SQTT tooling.
- **[Toward “no strings”: emit raw bytes (and maybe ELF only for compatibility)](#geohot-001730)**: Suggests skipping “transform DSL → strings → LLVM” by emitting bytecode directly (instructions already 2 bytes) and optionally packaging as ELF for compatibility.
- **[Flash Attention status: JIT causes NaNs; multi-device mismatch remains](#wozeparrot-002125)**: Wozeparrot says training works without JIT but NaNs appear with JIT; multi-device bug likely relates to something not being sharded properly.
- **[Harden JIT with assertions + schedule-cache consistency checks](#geohot-002302)**: Proposes asserting if JIT tries to access tensor bytes (e.g., `item`/`2data`/NumPy paths), adding an extra step to assert captured schedules match, and potentially copying outputs to avoid “outputs don’t change” foot-guns.
- **[Claude-assisted maintenance: speed up local tests; fix Hypothesis slowness by upgrading](#chenyu-002834)**: Chenyu says they got tests running locally fast (about a minute in parallel) and found Hypothesis slowness by profiling—initially suggesting invasive workarounds, then solving by updating the Hypothesis version.
- **[Debug=4 as an agent-friendly interface; remove wasteful NaN loads in image path](#chenyu-003217)**: Using `debug=4` dumps, Chenyu/Claude spot unnecessary NaN-lane loads in OpenPilot vision image loading; reports ~0.3s speedup and notes ongoing tension with plans to remove image dtype.
- **[Rewrite-rule UX: need command-line Viz; TRACK_MATCH_STATS=3 shows every match](#geohot-003710)**: Discusses that tracing rewrite interactions is hard; suggests better tooling (“C Viz” / CLI Viz) and points out `TRACK_MATCH_STATS=3` can print every matching rule for small cases.
- **[Drivers update: MI300/MI350 fixes, multi-SDMA support, AllReduce bandwidth](#nimlgen-004315)**: Nimlgen reports MI300/MI350 bug fixes and several SDMAs supported; mentions AllReduce around ~95 GB/s currently and discussion of practical link bandwidth limits.
- **[Mac eGPU path: avoid sudo/port-forwarding; prefer a signed shim that maps BARs](#geohot-004603)**: Geohot argues port-forwarding requiring sudo is fragile; suggests a small signed helper app that maps BAR memory into the Python process using stable APIs to improve usability and grow users.
- **[Investigate perf gap: SebV 49 TFLOPS vs Tinygrad 43; fixed clocks vs boost/overdrive](#geohot-004915)**: Raises the TFLOPS discrepancy and considers whether perf monitoring/fixed clocks prevent boost behavior; plans to compare against HIP to see if the delta reproduces.
- **[Image dtype roadmap: make image=1 fast via float16 storage + late renderer rewrites](#chrism-005628)**: Chrism notes `IMAGE=1` is merged but slower than `IMAGE=2` (example cited: ~34ms vs ~16.6ms); plan is to store in fp16 (cast/contig/cast) and add late rewrite rules for 2D indexing + autocast near the renderer.
- **[CTypes ergonomics: decorators for structs/functions while preserving speed](#chrism-010412)**: Chrism proposes dataclass-like decorators that read type annotations to define `ctypes.Structure` layouts and bind DLL functions; Geohot emphasizes keeping ctypes and avoiding any performance regression.

### Transcript
##### **Geohot** [[00:00:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=0)]
Let's start with company update.

##### **Geohot** [[00:00:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=8)]
Cool. So yeah, welcome everybody. I hear the 5090s now cost $5,000. So I don't know what we're going to do about that. You know, we might have to ask some TinyBox buyers for more money, but we're getting we're getting caught up on our on our backlog of orders. I think this is the year that we have to focus on getting users. I think we have a huge, the more I play with these LLMs, the more I realize what an advantage having a small, simple code basis. For example, I have a cloud right now playing with trying to set the overdrive in the SMU. Like imagine trying to do that without Tinygrad, right? Imagine trying to like, what's cloud going to do recompile the kernel? Just also like think about the PyTorch tests and the PyTorch compile times. What is the agent going to do? I don't understand how people do this. Right? Like I've never, I've never developed in a company that has like, well, it takes 30 minutes to build and then it takes two hours to run the tests. And then yeah, your thing will get merged. I don't know. I've just never worked in a company like that. So I don't know how people do it. And I'm sure no agents can't do it. So I think we have a huge advantage. And I think this is the year we're finally going to start to get users. So we got to focus on users for Tinygrad. Usability releases, good error messages. A lot of this stuff becomes so cheap with LLM agents to like, think of how good we can like, like, like make all the errors. You know, again, not from the LLM agent can't make the errors good, but it can find every edge case. And then good errors for humans are good errors for agents, right? So if we, if we have an output, a good agent, a good error, Tinygrad will be such a usable library for agents. So yeah, this is the year we get users. That's the company update. Tinygrad is going to have users and maybe even be 1.0 by the end of the year. I think 1.0 is doable. I think we can do that.

##### **Chenyu** [[00:02:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=128)]
Okay.

##### **Chenyu** [[00:02:09](https://www.youtube.com/watch?v=GNdNtguh1zo&t=129)]
I have a separate point down below because I spent my past week basically asked Claude to clean every part of Tinygrad and I have mixed results from that. Okay. Not sure.

##### **Geohot** [[00:02:21](https://www.youtube.com/watch?v=GNdNtguh1zo&t=141)]
Oh, yeah, yeah, yeah. No, it has no taste. Oh, Claude has no taste.

##### **Chenyu** [[00:02:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=145)]
It's more than that.

##### **Geohot** [[00:02:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=147)]
Okay. But yeah, I'm curious to hear. Yeah.

##### **Chenyu** [[00:02:30](https://www.youtube.com/watch?v=GNdNtguh1zo&t=150)]
Let's do a release this week.

##### **Wozeparrot** [[00:02:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=152)]
Oh yeah, we're going to do one last week, I think. Maybe today is a good day. Wait, you released? No. I thought we were planning on doing one last week and then I don't think a release actually went out.

##### **Chenyu** [[00:02:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=165)]
Oh, it's fine. We can do it today.

##### **Wozeparrot** [[00:02:46](https://www.youtube.com/watch?v=GNdNtguh1zo&t=166)]
Okay, I'll tag one this week then.

##### **Chenyu** [[00:02:49](https://www.youtube.com/watch?v=GNdNtguh1zo&t=169)]
Okay, great.

##### **Geohot** [[00:02:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=171)]
New year's release. New year's release. What's the version? 0.11.1?

##### **Chenyu** [[00:02:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=179)]
0.12?

##### **Geohot** [[00:03:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=181)]
I think we bump at a major version. I think we haven't even released since Rangeify.

##### **Wozeparrot** [[00:03:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=187)]
That's actually a good point. I don't know. Do people really care?

##### **Geohot** [[00:03:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=192)]
No, but I think 12 is good.

##### **Chenyu** [[00:03:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=194)]
Okay, 12 it is.

##### **Wozeparrot** [[00:03:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=195)]
We have to pick something.

##### **Geohot** [[00:03:16](https://www.youtube.com/watch?v=GNdNtguh1zo&t=196)]
Yeah, it's been six months since the last release.

##### **Chrism** [[00:03:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=199)]
Yeah.

##### **Chenyu** [[00:03:20](https://www.youtube.com/watch?v=GNdNtguh1zo&t=200)]
Great. Okay, 0.12. One time this week.

##### **Geohot** [[00:03:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=206)]
Great.

##### **Chenyu** [[00:03:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=208)]
We can quickly discuss..

##### **Chenyu** [[00:03:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=209)]
What's possible planning in general for the company? Sprint?

##### **Geohot** [[00:03:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=214)]
Yeah, I think that just every two weeks, it'd be nice to have a Discord bot post something and then everybody just write up kind of their plan for the next two weeks. We mess around with stuff. And for a while, we had this thing where people would give ratings to how well they did on the things, but that would all be done retroactively. So just kind of write up what you plan to get done in the next two weeks. And then maybe.. You know, we have that. We have a commit bot. And maybe just kind of, you know, check in and see if.. But it's more of a check in with yourself just to see how good of a job you did at planning for the next two weeks. Your ability to plan for two weeks is something that separates you from AI agents. There's not a single AI agent that has any ability to think on that time horizon. So, you know, prove you're not a robot and plan for two weeks. So, yeah, just kind of post. Post what you plan to get done in the next two weeks. And again, it's okay if it changes. But I want everyone here to do that, and I will do it as well. So, yeah. You saw my example sprint. It doesn't have to be more than that. Just kind of a bunch of bullet points about what you plan to get done in the next two weeks.

##### **Geohot** [[00:04:52](https://www.youtube.com/watch?v=GNdNtguh1zo&t=292)]
Anyone here has any question? Okay. Next.

##### **Chenyu** [[00:05:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=302)]
Welcome, Christoph, for the assembly.

##### **Geohot** [[00:05:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=306)]
Yeah, I think the DSL is kind of fun, right? I saw, Coslin, I saw you working on an RDNA4 assembly kernel. I have one. I re-implemented the Seb Matmul thing in the Python DSL. It's so much nicer than actually coding assembly for several reasons. Because, well, first off, you get syntax highlighting, like tab completion. I haven't seen an assembly that has tab completion. But it's kind of just like we don't have good.. I call it an IDE. Like the thing that I refer to in the readme is an IDE for assembly. Because, like, it's terrible to.. How are you supposed to know what all the instructions are? I'm sure there's.. I'm sure there's, like, IDEs that can do it, but, like, not VS code and stuff. So just, like, the infrastructure around assembly is really bad. The other thing that this lets you do is give registers semantic names. It also type checks for you. The type checking can be better. But when you run it, when it constructs the thing, if the thing can't be constructed, if you put, like, an S register where you should have put a V register, or if you have an immediate that's out of range, it'll give you an error. And, yeah, sure, an assembler is going to do that, too. But I find the Python error is a lot more.. readable than any assembly errors. So, yeah, you guys can check out that PR. That's kind of the shining example of the new AsmDSL. Oh, and, of course, you can use for loops. Like, you can use normal Python for loops to.. Just compare the readability of that to the stock assembly thing. Like, this one you actually can, like, have some confidence changing. There's a stock assembly you kind of can't. I want to get that stuff actually merged into TinyGradMaster. It'll be small. It should be about 500 lines total. It's a class that all those instructions inherit from. And then it's a.. All of that stuff is auto-generated from the AMD PDFs. So I have a PDF parser that goes in, and it just generates a bunch of Python. So, yeah. And then the whole rest of it, too. I have an emulator. It's nice to do, like, all these things kind of in parallel because they all kind of check each other. So I have an emulator. I have a thing that compiles. It compiles and decompiles from the LLVM assembly strings. I don't think I ever want to merge that into master. But that's very good for testing. I think that our syntax is a lot nicer than the LLVM syntax. In some ways, I'm missing a few things. But with a few more cleanups, I think it's just so much more readable than, like, strings. Strings. Strings are terrible. Like, all the renderers that use strings, concatenating strings together. Nothing should ever concatenate strings together. You should go right to bytecode. It's up.

##### **Chrism** [[00:07:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=479)]
Yeah.

##### **Geohot** [[00:08:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=480)]
That's the assembly DSL. I'm more and more excited about it the more I think about it. I'm like, you know, this is just like a side project as you're really working on core TinyGrad. But I think that this is a really important piece of TinyGrad because it's the last dependency that TinyGrad has. We talk about how TinyGrad has no dependencies, but in reality, if you don't have LLVM, all you can do is use the Python backend, LLVM or Mesa or WebGPU. But, yeah, those are all. Mesa's not based on LLVM, but it's all. It's all kind of LLVM. So, yeah, this is the truth of just the machine code that goes into the GPU. Yeah, and I'm outperforming. So, in terms of really high-performance kernels, there's that SebV FP32 GEMM. We're outperforming it by 5% with this one just by, you know, cleaning things up. And a lot of it just comes from the syntax being clear. Once you have clear syntax, you're like, oh, this register actually isn't used. Oh, yeah, so you can just, like, clean things up. Yeah, that's the assembly project, and that's what we'll be working on for the next two weeks.

##### **Geohot** [[00:09:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=544)]
I have a bunch of stuff in the sprints. Gauzlin, you want to go next? It's just kind of related.

##### **Qazalin** [[00:09:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=559)]
I think I've also been doing RDNA4 since I have it at home. I needed some tiny stuff changes. I'm going to do a little bit of RDNA4 main DSL. Hopefully, that should be fixed.

##### **Geohot** [[00:09:33](https://www.youtube.com/watch?v=GNdNtguh1zo&t=573)]
I'll do RDNA4 today if RDNA4 is important to you. I did CDNA, but I can do RDNA as well. The RDNA4 is just generated and not tested, but I can make sure it's start to be tested.

##### **Qazalin** [[00:09:47](https://www.youtube.com/watch?v=GNdNtguh1zo&t=587)]
Yeah, thanks. The changes were super small. In general, I found that.. So, I did fast GEMMs. I did CDNA, RDNA3, and RDNA4. This one's the first one that fits Cloud context. Cloud can actually read it and change the code. Oh, so, yeah, I mean.. Yeah.

##### **Geohot** [[00:10:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=612)]
Oh, go ahead.

##### **Qazalin** [[00:10:13](https://www.youtube.com/watch?v=GNdNtguh1zo&t=613)]
It's about 700 lines of Python with for loops and stuff, and it gets around 70% on my machine.

##### **Geohot** [[00:10:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=625)]
Oh, I see how you did for loops. I see some of them are inline like that, but you could do it. You could do all the WAMAs in for loops, too. I think this is still like.. You don't actually need all of this pipelining where it's interleaving the local stores and the WAMAs. Do you actually need that?

##### **Qazalin** [[00:10:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=642)]
Oh, yeah. Really? It's very interesting just profiling it. It's doing a two-way ping pong, so it's increasing the size of the WAMAs by making two waves collaborate on the.. Yeah.

##### **Geohot** [[00:10:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=658)]
Interesting. What's your occupancy?

##### **Qazalin** [[00:11:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=662)]
It's actually pretty good.

##### **Geohot** [[00:11:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=665)]
Well, how many waves do you have in Python?

##### **Qazalin** [[00:11:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=667)]
Oh, two. Wait. Two per SIMD.

##### **Geohot** [[00:11:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=672)]
How do you only have.. Oh, two per SIMD. So you mean eight. Yeah. I don't know. How many VGPRs does RDNA4 have? So you're using the full 256.

##### **Qazalin** [[00:11:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=689)]
Yeah. I don't think I need to, but that's a separate thing I have to fix.

##### **Geohot** [[00:11:35](https://www.youtube.com/watch?v=GNdNtguh1zo&t=695)]
So RDNA4 has a 192K register file. So yeah, you can have, theoretically, an occupancy of up to six with that.

##### **Geohot** [[00:11:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=711)]
But do you know what I mean by occupancy?

##### **Qazalin** [[00:11:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=715)]
Number of waves that are scheduled on the SIMD?

##### **Geohot** [[00:11:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=718)]
Yeah. Number of waves that are in flight at the same time.

##### **Geohot** [[00:12:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=721)]
So you should be getting six, not two, right? I'll check again, maybe. Yeah.

##### **Geohot** [[00:12:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=734)]
If you just look at the occupancy times and you figure out.. They also have this little bit of overlap where they schedule and you can get more than six because it sends that message

##### **Geohot** [[00:12:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=746)]
to deallocate the VGPRs. So that's a good thing. But yeah, I like the.. Is it using the SQTT-rock stuff?

##### **Qazalin** [[00:12:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=762)]
It is using the command line interface. We have a terminal tool for the SQTT stuff now. It's very usable for humans too.

##### **Geohot** [[00:12:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=771)]
Yeah, yeah. I like it.

##### **Qazalin** [[00:12:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=773)]
Yeah.

##### **Geohot** [[00:12:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=775)]
Cool. Yeah, no. It's nice to start. Yeah. It's nice to push into these really high-end kernels. I don't know. The more I think about assembly, the more I think it's just a UI problem.

##### **Geohot** [[00:13:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=791)]
It's a UX problem. People worked really hard to make Python usable, but nobody's worked hard to make assembly usable. Yeah.

##### **Qazalin** [[00:13:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=808)]
I found still cloud tends to change stuff that don't really actually change performance that much. So it's that tooling problem that even the other one can't really solve.

##### **Geohot** [[00:13:40](https://www.youtube.com/watch?v=GNdNtguh1zo&t=820)]
Oh, yeah. No, I mean cloud.

##### **Qazalin** [[00:13:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=822)]
Yeah. Cloud can make it very clean. I made it go through every single line, make sure the register is used. That was one of the first things I did then. That saved a couple of milliseconds. It's a couple of milliseconds, sorry. Yeah. But so it's very good at cleaning things up

##### **Geohot** [[00:14:03](https://www.youtube.com/watch?v=GNdNtguh1zo&t=843)]
that are provably a good thing. Every one of the speed ups was done by me.

##### **Geohot** [[00:14:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=854)]
Speed ups. No, it's no good at that. I got like 5% over the said matmul, but every single one of the things was just done by me thinking about it. And looking at the SQTT and just doing it. But yeah, no, I think also what we can do is more search. We can automate every bit of pipelining and stuff.

##### **Geohot** [[00:14:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=883)]
Just have it try every combination. Parameterize it.

##### **Geohot** [[00:14:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=895)]
I don't know if the load WAME interleaving in your, in your kernel is absolutely right. Yeah, if this can be.

##### **Geohot** [[00:15:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=905)]
I think this can be a lot more for loops too.

##### **Qazalin** [[00:15:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=908)]
It can be a lot more Thunder kittens. Like the idea is the tile layouts and the indexing.

##### **Geohot** [[00:15:18](https://www.youtube.com/watch?v=GNdNtguh1zo&t=918)]
Yeah. See how it kind of meets in the layout. See how you have the vperm.

##### **Qazalin** [[00:15:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=925)]
Yeah.

##### **Geohot** [[00:15:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=926)]
What's vperm?

##### **Qazalin** [[00:15:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=929)]
vperm. You look at it and it's a bunch of vperms. So basically like the kernel is a bunch of LDS stores and then permutes the VGPRs and then the WAMAs. So vperm is like Thunder kittens calls it swap layout.

##### **Geohot** [[00:15:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=948)]
Yeah.

##### **Qazalin** [[00:15:49](https://www.youtube.com/watch?v=GNdNtguh1zo&t=949)]
You change the layout of the LDS to something WAMAs can do.

##### **Geohot** [[00:15:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=955)]
Hmm. Permute. Basically.

##### **Chrism** [[00:16:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=961)]
Cool.

##### **Geohot** [[00:16:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=962)]
Yeah. You know now I think we see where all the, uh, we're all the bridges. Uh, all the pieces that we have to build in order to get tiny guy to actually output this code, how fast is our jam on? Uh, I guess you're doing RDNA for now, not CDNA.

##### **Qazalin** [[00:16:31](https://www.youtube.com/watch?v=GNdNtguh1zo&t=991)]
CDNA is still the same 1.3 petaflops. I have not touched that code because I can't read it yet. It's a text.

##### **Geohot** [[00:16:41](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1001)]
Well, yeah, I'll merge the CDNA assembler now. I think let's get fast GEMMs into our training loop.

##### **Geohot** [[00:16:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1010)]
Intensor. Yeah, I'll try.

##### **Qazalin** [[00:16:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1015)]
I can start reasoning about the loop dimensions and how they deal with the different strides.

##### **Geohot** [[00:17:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1024)]
This is great. Then that's full for those things. We can just entirely lower to assembly right there from the GEMM.

##### **Qazalin** [[00:17:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1034)]
Oh, you mentioned that I also added support for sensor custom kernel to take assembly. Like take storage. So if you return an offset program, it will just use that.

##### **Geohot** [[00:17:30](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1050)]
We should also just take the raw binary too. You could compile it, but you would have to work on that. Like right now we have this DSL and then we transform the DSL into strings and then LLVM transports the strings into machine code. But all the DSL instructions have just two bytes on them. They can just go right to bytes.

##### **Qazalin** [[00:17:52](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1072)]
Oh yeah, yeah. You can just put the ELF together.

##### **Geohot** [[00:17:57](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1077)]
Well, why do we even need to put an ELF together? We probably do want to put an ELF together, but just for compatibility reasons. But we don't have to. Yeah, we need the..actually, you want to work on that?

##### **Geohot** [[00:18:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1094)]
You want to do the opposite of ELF?

##### **Qazalin** [[00:18:18](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1098)]
The opposite of ELF. Just take the struct, yeah.

##### **Geohot** [[00:18:22](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1102)]
Yeah, that sounds right.

##### **Geohot** [[00:18:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1105)]
Yeah, I mean, it'd be nice to just..yeah, if you're..you can add that to program as well. So then we can go fully from just write things in our DSL and then..

##### **Geohot** [[00:18:37](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1117)]
I'll go right to the actual GPL.

##### **Qazalin** [[00:18:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1123)]
As you read your emu.py made the code shine, it looks really pretty. I wish you emu looked like that.

##### **Geohot** [[00:18:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1130)]
Thank you. Yeah, yeah. Yeah, yeah. I mean, our py's getting good. We have more to do on it, too. But yeah, right? It turns out to be so simple.

##### **Qazalin** [[00:19:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1142)]
It's, I think, less than 200 lines. And it is correct.

##### **Geohot** [[00:19:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1146)]
It's more correct than remu.

##### **Geohot** [[00:19:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1148)]
However, it's 100x slower than remu. I think I can get that down to 10x. And then I think.. And we have a Python emulator.

##### **Qazalin** [[00:19:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1163)]
I'll keep remu in my little corner.

##### **Geohot** [[00:19:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1167)]
Well, we'll keep remu up there for the compare emulator test. That's kind of the best test to quickly find bugs. Oh, remu is more correct than..I tried the real one. I tried Navisim. Remu is more correct than Navisim.

##### **Chenyu** [[00:19:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1185)]
In what way?

##### **Geohot** [[00:19:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1188)]
Navisim just has many instructions implemented incorrectly. Oh, okay. I wrote, like, a thing to compare all three emulators. And there's many where mine and remu match. Mine, remu, and the hardware match. Actually, I wrote tests to really compare to the hardware. And Navisim's just wrong.

##### **Qazalin** [[00:20:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1204)]
Okay.

##### **Geohot** [[00:20:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1206)]
Oh, and then the other thing that I'm really excited about is cycle-accurate emulation. It's hard. RDNA3 is very complicated as a microarchitecture. There's caching on the registers.

##### **Qazalin** [[00:20:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1223)]
Absolutely. There's banking on the registers.

##### **Geohot** [[00:20:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1227)]
They're banked and they're cached, yes. And the caches are cached based on which source port you read it from. There's three source ports. Whatever. But..

##### **Chrism** [[00:20:39](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1239)]
Cool.

##### **Geohot** [[00:20:40](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1240)]
Yeah, but I'm glad you like the AsmDSL. I think this is a good direction to go in. And then just improve your code. And improve usability of that. Like, make it really easy from outside of TinyGrad, right? Your stuff shouldn't be special to inside TinyGrad. It should be really easy for a user to write a fully-assembly kernel and just kind of inline

##### **Geohot** [[00:20:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1258)]
that with tensors and have it work. Sounds good. Okay. Speaking of training loop, I didn't really do anything.

##### **Chenyu** [[00:21:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1275)]
So, I'm going to do a little bit of a test. So, Wolfberry, do you have any update for Flash Attention? Or I know you're at CES this week. So, if there's anything I can help, I can also help.

##### **Wozeparrot** [[00:21:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1285)]
It's mainly just this JIT bug. So, I have two issues.

##### **Chenyu** [[00:21:30](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1290)]
One was the numerical NAN issue and another is the device mismatch for multi-device.

##### **Wozeparrot** [[00:21:36](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1296)]
Yes. So, there's two bugs left. It is the JIT bug, which causes the NAN. If you get rid of JIT, it trains fine.

##### **Geohot** [[00:21:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1305)]
And then just the multi-device one.

##### **Chenyu** [[00:21:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1310)]
You want me to work on.. I don't know if I can work on the JIT one, but I can look into it. Yeah, I will do the JIT one.

##### **Wozeparrot** [[00:21:56](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1316)]
If you want to look at multi-device..

##### **Chrism** [[00:21:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1318)]
Okay.

##### **Chenyu** [[00:21:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1319)]
Do you know what the issue might be?

##### **Chenyu** [[00:22:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1320)]
Or I would look?

##### **Wozeparrot** [[00:22:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1322)]
For multi-device? I took a quick look at it. I think one of the.. Probably the LVAC is not sharded properly.

##### **Geohot** [[00:22:17](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1337)]
Okay, I will look.

##### **Wozeparrot** [[00:22:21](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1341)]
But the JIT issue is very strange because the kernels.. We get a cache hit. Like, schedule cache does hit. And then something else is wrong in JIT.

##### **Chenyu** [[00:22:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1354)]
Oh, so another thing that I don't have a good solution now is in tensor.py, or in general, we support some functions. That is not JIT-able because it calls item somewhere. We currently allow those in tensor.py, and we just kind of need to be mindful that don't use those if you want to use JIT, which is kind of annoying. I don't know if George, you have any idea on this.

##### **Geohot** [[00:23:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1382)]
So, I mean, we could disallow realization in the JIT. Or at least not realization, but copy out. Like, what I would probably do is.. I think this is mostly a UX issue, and you want to add an assert if it ever tries to access any bytes from any tensors. You can do copy to different devices, all that's fine. But yeah, if it actually calls item, the problem is that it's doing.. That it's calling numpy or 2data or something. So, just add an assert there.

##### **Chenyu** [[00:23:39](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1419)]
That's pretty good. I don't think this is an issue, but this is just generally.. Because I was reading tensor, and we have probably at least like two, three functions that has this. We at least want to make the arrow explicitly clear.

##### **Chenyu** [[00:23:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1435)]
Yeah.

##### **Geohot** [[00:23:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1438)]
Okay, so legit issue.. I don't know. I mean, what I would really..

##### **Chenyu** [[00:24:18](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1458)]
I mean, what I would.. Code wrong, like none in my device?

##### **Wozeparrot** [[00:24:24](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1464)]
No, but I've moved over to MI300, and I've been testing on that.

##### **Chenyu** [[00:24:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1469)]
And it has the same NEN issue?

##### **Wozeparrot** [[00:24:31](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1471)]
Yes.

##### **Chenyu** [[00:24:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1472)]
Okay.

##### **Geohot** [[00:24:35](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1475)]
MI300 and MI350 are almost identical. Yeah.

##### **Chrism** [[00:24:38](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1478)]
Yeah. Yeah. Yeah.

##### **Chenyu** [[00:24:40](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1480)]
Do you know if it has the issue if you just run forward?

##### **Geohot** [[00:24:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1485)]
No, just forward is fine. I've tested LLaMA eval already, and LLaMA eval runs fine.

##### **Chenyu** [[00:24:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1493)]
I see.

##### **Chenyu** [[00:24:57](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1497)]
Okay, let's discuss this separately. I don't think we can get anything meaningful in this meeting, but I really want to get something StarCode-tran.

##### **Geohot** [[00:25:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1506)]
Yeah, should have something this week.

##### **Geohot** [[00:25:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1507)]
I want to talk a little about the JIT and chat. I don't know. I'm really happy if.. Part of the problem with me just rewriting it is I'll just deliver another thing that's not comprehensible, and has a bunch of random foot guns and stuff. I mean, yeah. I think that probably instead of rewriting the JIT, what we want to do is just add more assertions to the JIT.

##### **Chenyu** [[00:25:38](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1538)]
Yeah, I think that's a good start. Yeah, I think that's a good start. Because the only real way we improve these, I think Torch compile may have a similar issue. JAX's compile has a similar issue. These are like usability errors that only when people start to use it and use it more extensively will find. It's very hard to design these upfront correctly. So I think we already, I already find like the issue when I was implemented gradient accumulation in BERT that I would just walk around. Oh yeah. Adding more asserts here.

##### **Geohot** [[00:26:20](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1580)]
An assert that should kind of get everything is if you add a, another step. So right now we run the JIT for like three steps. If you add one step, you get a new step. If you add one more step and then have it assert that that step captures the exact same

##### **Geohot** [[00:26:36](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1596)]
schedule cache, then I think that assert will catch a lot of bugs with the jet.

##### **Chenyu** [[00:26:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1608)]
Yeah.

##### **Chenyu** [[00:26:49](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1609)]
So, so what's Paris said, no schedule cache hit or for his case.

##### **Geohot** [[00:26:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1613)]
I know, I know then this is a different bug, but I'm saying that like a lot of the generic bugs, like all of the gradient accumulation bugs would have been caught by this. So there's that.

##### **Chenyu** [[00:27:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1622)]
Yeah. We're going to put the bug flag or something that just does that.

##### **Geohot** [[00:27:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1626)]
And then the other I think we can just do it by default. It's one more step.

##### **Chenyu** [[00:27:13](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1633)]
It's already weird.

##### **Geohot** [[00:27:17](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1637)]
Then the other thing that we could do is the other thing that everyone complains about, about the jet is output copies. The outputs don't change.

##### **Geohot** [[00:27:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1646)]
Let's just fix them all. Just have it make a copy. Like who cares? Sure. I think there are more issues to that, but yeah. If you have it make a copy and just make a new one. Yeah, I think that's right there.

##### **Chrism** [[00:27:49](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1669)]
Yeah.

##### **Geohot** [[00:27:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1670)]
Okay, cool. But yeah, no, I think that that the jet thing, instead of me just like writing a new jet,

##### **Chenyu** [[00:27:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1673)]
which is going to have new bullshit, just, just, you know, we don't need a new jet yet. That's my, that was my philosophy for gradient accumulation. I got a workaround that was working and that's good enough.

##### **Geohot** [[00:28:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1684)]
Right. Yeah. I mean, tests and asserts are what we need before we write a new jet.

##### **Geohot** [[00:28:09](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1689)]
Yeah.

##### **Chrism** [[00:28:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1692)]
Cool.

##### **Chenyu** [[00:28:13](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1693)]
Okay. I will, I will help with the, with the device stuff and jet. I will, I will take a look and we'll, we, we need to decide what to do next.

##### **Chrism** [[00:28:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1705)]
Okay.

##### **Chenyu** [[00:28:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1709)]
Next is. So I use clouds. I'm going to use cloud to clean many of.

##### **Chenyu** [[00:28:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1714)]
I'm reading through my PRs from last week. Also, I enable the ignore OOB, the Z3 check on CI only. So it's still default to false because I don't want it to causing issues, but on CI and in test, everything is fine. I think cloud fix a small issue. So these are easy. So what I found is, so first I fixed all the tests to run locally and run locally fast. I think I can run through all the tests within a minute using parallel. Well, that was, that was important. I think it's important to have some, some loop that can like run fast and do your stuff.

##### **Geohot** [[00:29:20](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1760)]
Yeah. So you posted the tweet. Yeah, totally, totally agree.

##### **Chenyu** [[00:29:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1763)]
Yeah. Also fix the hypothesis. So I think another, a thing I found. Like cloud does more diligently than me is say the hypothesis issue. It just goes through the hypothesis source code and profile each bit of that and find out why it's so slow. And the stupid part is initially it suggests a workaround to, I don't know, change the hypothesis internal. And that was great. Then I ask, can you try updating the hypothesis version to see if it's fixed? Then they update it and it's fixed. So that's great. So sometimes, sometimes it will try too hard. Then I fix. So another thing I did is I, I tried to use cloud to comment on every rewriting rules and see if the tests still pass. And I specifically test, I test metal because I'm working on Mac. Then web GPU, because I know there are web GPUs. So I can test the CPU specific rules and LLVM for similar reasons. Well, that was pretty useful. I found several rules that by commenting out, also I teach cloud how to run process replay locally. That was also kind of useful. So you can basically commenting out rules and run process replay to making sure things are correct. I deleted bunch of rules. Oh, I also asked cloud to, you know, I'm not sure. I'm not sure. I'm going to read through. Look, it's diff to find the initial comment and make a judgment call to see if it's just oversight or is actually useful. I don't know if less than useful, but that's what it did. Well, I ended up deleting bunch of rules that by inspection, I cannot tell is doing anything. So that was also, that's a little better part. Then I asked Cloud to look into the OpenPilot driver vision model with debug equals to 4. It prints all the source code and asks Cloud to read it to find anything that looks dumb or should be able to simplify. And it complains about the NaN in loading image, because image has four channels. And for some reason, after rangeify, there was a code that always inited with NaN, even though you know it's between 0, 1, 2, 3. It never should load the NaN, basically.

##### **Geohot** [[00:32:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1935)]
Yeah, I remember that.

##### **Chenyu** [[00:32:17](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1937)]
Yeah, so that is not complete, because there's another rabbit hole for the C mod. For negative numbers, can be negative, some weird issues like that. But for the general negative case, you don't need to load NaN. So that's kind of 0.3 seconds faster for OpenPilot, considering that win. It's that much? Wow. It's a lot of NaN. I think Cloud counts like 200 or something like that.

##### **Geohot** [[00:32:55](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1975)]
That should only happen when the load isn't four byte aligned.

##### **Chenyu** [[00:33:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1984)]
I think even.. So the image load code, even if it was, it still does that. I don't know. I mean, the div looks pretty clean, so..

##### **Geohot** [[00:33:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=1995)]
Yeah, no, I mean, I read the back end. I read the back end. I think it's pretty clean. I read the PR when that went in, too. But I thought that that was such a fallback path that it never happens. It only happens in one or two of the kernels. I'm shocked that that's happening more.

##### **Chenyu** [[00:33:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2009)]
I know we have a plan to remove image D type altogether. So this is just to make that task more difficult.

##### **Geohot** [[00:33:37](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2017)]
Yeah, I don't know, but I think we still kind of need this. But again, I really thought that.. Because I wrote that code. And I was like, oh, this is never actually going to happen. Right? Like, I just wrote the code to save lines. But I wrote the code to do the NaN thing to save lines. But.. Yeah. Uh.. So.. Like..

##### **Chenyu** [[00:33:56](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2036)]
Yeah. That's fine.

##### **Chenyu** [[00:33:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2038)]
I think here my conclusion is debug equals to four is really good. Or.. I mean, it was really.. It was already good for me to debug kernel and find performance. It's even better for, like, agents to do that. Or maybe down the line we will have, like, assembly and very good emulators and things like that. But it's a very good interface.

##### **Geohot** [[00:34:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2063)]
Yeah. I mean, yeah. This is.. What is less good..

##### **Chrism** [[00:34:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2067)]
Yeah.

##### **Chenyu** [[00:34:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2068)]
What is less good is to tracing all the rewriting rules. And this clouds really struggle. So the idea is can we combine certain rewriting rules or basically.. Because we have a lot of different stages or steps of, like, bigger groups of rewrites. And I want to understand if it's possible for it to try.. Maybe this is just very hard to brute force. But for now, it's very hard for it to read through, like, this minus one, minus two stuff and tracing through the rewriting rules. In fact, rewrite status was really useful to delete, like, never.. Never.. Rules that never hit because it's, like, binary and it's very easy to read. But tracing a rewrite and understand the kind of interaction between rules is very hard. I don't know how to correctly pull that context or prompt it with yourself. So that was all the simplification of merge rules I need to do manually. And I can do that because I know that's right.

##### **Geohot** [[00:35:35](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2135)]
Yeah. I mean, the question is, is this a, like, display problem or is this a fundamental problem?

##### **Chenyu** [[00:35:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2142)]
I think it's a display problem similar to I always have complaint that it is very hard to use. But I don't have a good alternative or the way I want it to be. So I don't really know.

##### **Geohot** [[00:35:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2158)]
Yeah. I mean, I don't know. I find Viz a lot more usable than, like.. So you can print all the match rules with track match stats equals three.

##### **Chenyu** [[00:36:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2165)]
Oh, I see. Okay.

##### **Geohot** [[00:36:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2167)]
You can try it. Yeah, you can try track match stats. I mean, it'll work for small things. Oh, yeah.

##### **Chenyu** [[00:36:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2172)]
I tried that with two. I didn't know there was a three.

##### **Geohot** [[00:36:16](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2176)]
Oh, yeah, there's a three. Yeah, yeah. Three will show you literally every rule that matches. Okay. Great. So, yeah, for tiny things and for tests, I bet that we can probably improve that. And I bet that's going to work. I don't know. I mean, like, Viz is the best UI I've ever seen for this. Yeah.

##### **Chenyu** [[00:36:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2194)]
I think it's just maybe for more compact and, like, text-only versions. It's not the most, like, informative way to present the data. So maybe more like a UI issue.

##### **Geohot** [[00:36:49](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2209)]
Yeah.

##### **Chenyu** [[00:36:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2210)]
I mean, yeah. Because all the colors and arrows are really useful for humans. Yes. That's how you replace stuff. But debug equals to four or two is very useful because it's, like, linear and text-only.

##### **Geohot** [[00:37:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2227)]
Yeah. We need C Viz.

##### **Geohot** [[00:37:10](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2230)]
We need command line Viz.

##### **Chrism** [[00:37:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2235)]
We need to have a command line Viz.

##### **Geohot** [[00:37:16](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2236)]
I mean, Viz equals minus one and two are not meant to be entire visualizers. They're just meant to give you the pickle file. And then you can we can write tools. Yeah, yeah, of course. Right? Like, the idea is that we should write tools very, very tastefully and carefully that give humans a good interface to use those pickle files. And they happen to also work for agents. Okay.

##### **Chenyu** [[00:37:38](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2258)]
Then, finally, I also fix a lot of tools. So, like, for example, tensor and basically the very higher level stuff in tensor.py, onnx.py. There were, like, several to-dos. We have some functions that is just a giant blob of functions. Imagine something like or get item or resize or pad, things like that. I find it useful to just that and output something.

##### **Chenyu** [[00:38:09](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2289)]
Yeah.

##### **Chenyu** [[00:38:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2291)]
It's very good at, like, fixing small spec issue in ONNX. Because it will try random stuff until it works. And it will try a lot more comprehensive test cases than maybe what we have test coverage for. The lows are fine. I'm sure there are more. But I probably won't do them all. But if anyone is interested, I think we can do that. So, I'll show you some examples. So, it's basically how other people will use tinygrad. Right? It's like can Asian write tinygrad in higher level to train a model or implement some ops that they want. So, I think this layer is good. We just have sometimes we have inconsistent error message and different error types. Sometimes it's a runtime error. Like small inconsistency. LLM doesn't really have issues on these.

##### **Chenyu** [[00:39:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2352)]
But it's more of having a consistent error system from the library.

##### **Geohot** [[00:39:20](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2360)]
Yeah. Great. Definitely. Yeah.

##### **Chenyu** [[00:39:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2367)]
So, overall, I think there are many things that can be further polished. I probably won't spend too much time on this. But so far it's pretty positive. And a lot of I feel between so there are codes that we want the very highest quality code with quality. And I know currently tinygrad several pieces doesn't hit really hit that. And there are pieces of code that LLM can read. And I feel that's the. There are pieces of code. Even though we cannot really polish it to the perfect level, making it LLM readable is probably already a very good improvement. That's my current standard.

##### **Geohot** [[00:40:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2426)]
Definitely finds very subtle bugs.

##### **Geohot** [[00:40:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2428)]
We have the zero and the negative zero bug.

##### **Chenyu** [[00:40:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2434)]
Oh, yes. That we kind of always know. But it's kind of annoying. I mean. Because Python doesn't have this.

##### **Geohot** [[00:40:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2445)]
It does. Python has zero and negative zero. Of course it does.

##### **Chenyu** [[00:40:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2448)]
No, but it is equal.

##### **Geohot** [[00:40:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2451)]
I know.

##### **Chenyu** [[00:40:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2453)]
Yeah. So that's why somewhere we have the copy sign thing.

##### **Geohot** [[00:40:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2459)]
Yeah. I mean, the bigger problem is just the uop deduping is like broken for float consts.

##### **Chenyu** [[00:41:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2465)]
Oh, I see.

##### **Geohot** [[00:41:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2466)]
It dedupes the uops is the problem. So if the first thing you create is negative zero, all the uops are going to have negative zero. Even if you create the other ones without negative zero.

##### **Chenyu** [[00:41:16](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2476)]
Yeah. So the issue seems to be zero and minus zero just shouldn't eval to equal.

##### **Geohot** [[00:41:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2483)]
They shouldn't be equal. Yeah. I mean, the uop deduper should not work on zero and negative zero. And this can introduce all kinds of problems in like process replay and stuff.

##### **Chrism** [[00:41:31](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2491)]
Yeah.

##### **Chenyu** [[00:41:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2492)]
Does it eval NaN to NaN?

##### **Geohot** [[00:41:37](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2497)]
Well, I don't know about that might be a problem too. And maybe all the NaNs aren't the same, right? And that's a whole nother problem. So.

##### **Chenyu** [[00:41:44](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2504)]
Okay.

##### **Geohot** [[00:41:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2505)]
Anyway. What we might the fix for this might be just to have float const be integers. Like right now we have float const be floats, but they probably shouldn't be.

##### **Geohot** [[00:42:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2520)]
Just have it be the bit field or a particular.

##### **Chrism** [[00:42:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2524)]
Yeah.

##### **Geohot** [[00:42:09](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2529)]
I mean, it's just something to know.

##### **Chenyu** [[00:42:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2531)]
But then you run into all the silent NaN and all the different kinds of NaN.

##### **Geohot** [[00:42:17](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2537)]
Oh, I've learned a lot about different types of NaNs recently. Quiet NaNs.

##### **Chenyu** [[00:42:21](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2541)]
Okay. Anyway, I digress. Okay. So I think I still encourage everyone to try for maybe not for the employee, but for the NaNs. So for everyone in this meeting, if you are interested in using TinyGrad, there are several to-dos, especially in the ONNX and tensor.py. I think cloud does this really well. You can use this to practice the workflow. Don't commit AI slop. Don't try to open PR for that. We'll close it. But there are legit use case that will help both developers, maintainers and the users for TinyGrad.

##### **Geohot** [[00:43:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2580)]
So give it a try. Okay. Next, drivers.

##### **Nimlgen** [[00:43:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2595)]
Fixed some bugs on for the Mi 300, the Mi 350. Also, we now support several SDMAs on AM and in our runtime. And we also have a lot of things that we can do. So if you have any questions, feel free to ask. Actually, the old reduce for on a Mi 300 is about 95 gigabyte a second right now. So the theoretical maximum is for the old reduce is 150. I mean, 150 or 180. It depends. And..

##### **Geohot** [[00:43:56](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2636)]
By 150 or 180. I mean.. Yeah. So.. Actually, that depends.

##### **Nimlgen** [[00:44:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2647)]
No, actually, I mean, it's.. I mean, it depends on the slowest link. So then not equaling because we need to wait for all links. It's..

##### **Nimlgen** [[00:44:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2659)]
It's about..

##### **Nimlgen** [[00:44:20](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2660)]
Yeah.

##### **Geohot** [[00:44:22](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2662)]
How do you get 150 or 180?

##### **Nimlgen** [[00:44:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2667)]
So, I mean, in theory, these links are 64 gigabyte a second. Yeah. So, you can get, like, from one GPU to all other different seven GPUs. But in practice, I've seen, like, 45. And actually, the same thing's stated in the AMD docs. So, like, the practical speed is 45 gigabyte a second.

##### **Geohot** [[00:44:54](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2694)]
But speed is.. So, for one.. Yeah. Yeah.

##### **Chrism** [[00:45:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2701)]
Yeah.

##### **Geohot** [[00:45:03](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2703)]
What is the speaker Danke, for example, and cooling? Okay, Hold on. I have to turn that off for a minute on this one, because I..

##### **Nimlgen** [[00:45:13](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2713)]
But it never stops until it wakes.. It doesn't sound like exactly this, but.. So, basically, it is 90 gigabyte a second for all generatiques of our hardware. So that's half of that speed. And we also have several kernels because of contiguous and action is. So yeah, that's.

##### **Geohot** [[00:45:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2742)]
Yeah, I mean, I'm curious what the stock AMD AllReduce gets like with Rikol and then how close we are to that. I mean, if we're already up to that or beating that,

##### **Geohot** [[00:45:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2753)]
then we're good. Yeah, OK, I'll measure that.

##### **Chrism** [[00:46:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2762)]
Cool.

##### **Geohot** [[00:46:03](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2763)]
Two other driver things. One is Mac without SIP.

##### **Nimlgen** [[00:46:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2779)]
Yeah, OK, I'll just try to actually to wipe code something, but it was. I mean, that try was bad. Yeah. But actually, because you need. It's Suda still at least to like to do forward port on Mac OS, I think.

##### **Geohot** [[00:46:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2803)]
Need Suda? Why?

##### **Nimlgen** [[00:46:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2808)]
So to forward port from one P to another one.

##### **Geohot** [[00:46:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2813)]
Oh.

##### **Geohot** [[00:46:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2818)]
How much code is it just have a shim? Process? We put things through the shim process.

##### **Geohot** [[00:47:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2824)]
Like instead of forwarding the port, what if we just share the memory? So I'd know I need to try that.

##### **Nimlgen** [[00:47:17](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2837)]
Actually, I don't have a picture how this should work. Like. Yeah.

##### **Geohot** [[00:47:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2843)]
Forwarding the port sounds fun, but if it requires pseudo, I think that like we don't change it that much. The right thing to probably do. Is just have a small signed application that like maps the bars.

##### **Geohot** [[00:47:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2854)]
And then it maps the bars into the Python process. We should need pseudo for that, right? I don't know.

##### **Nimlgen** [[00:47:44](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2864)]
I mean, like you want shim application, like the signed application to map memory into Python.

##### **Geohot** [[00:47:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2873)]
Yeah.

##### **Nimlgen** [[00:47:56](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2876)]
So. I don't know. I mean, I don't know about my cause. I mean, all the security things and to check that. I know.

##### **Geohot** [[00:48:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2887)]
I know it's annoying, but like. I think that this is a good way to get users. I think we can get a lot of users like this. I think there's a lot of people who want to plug GPUs into their Mac. Comma is also coming out with a, we're working on that, working on boards for that USB controller. I have the whole firmware. I don't know if you've checked out the, the review of the Mac. But it's like all pretty much reverse engineered. Not perfect, but I think we're just going to write our own firmware for that. And yeah, so I see this being a big potential way we're going to get users and we do need to make this, this experience good. I know the Apple security stuff sucks, but we should also just do it in a way. That's like, even if it requires a shim application that does the mapping, like we should do it using stable APIs. The port thing's cool, but I think. That especially if it requires sudo, I mean, it'll require sudo.

##### **Geohot** [[00:49:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2944)]
And then in the next update, it'll just be blocked entirely. Yeah, so yeah, I'll try that. Cool.

##### **Geohot** [[00:49:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2955)]
And one other driver thing. How come Seb V claims he gets 49 teraflops and we only get 43?

##### **Nimlgen** [[00:49:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2968)]
Yeah, I've seen that. I know. I need to look into that. Because actually, AM sometimes matches or sometimes outperforms AMD GPU.

##### **Geohot** [[00:49:41](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2981)]
Is there, are we enabling like overdrive or enabling boost clocks?

##### **Nimlgen** [[00:49:46](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2986)]
I mean, we said the highest clock which SMU reports to us.

##### **Geohot** [[00:49:53](https://www.youtube.com/watch?v=GNdNtguh1zo&t=2993)]
Yeah, but I think there's, so that's like the base clock, but then there's also like a boost clock and there's an overdrive.

##### **Nimlgen** [[00:50:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3001)]
Yeah. Yeah, I've seen something like that. I mean, some overdrive tables. Yeah, I can take a look into that.

##### **Wozeparrot** [[00:50:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3011)]
You probably don't want overdrive. At least the GPU stock aren't overdriven. Overdrive is just AMD's like free overclocking thing. Like you can just freely adjust the voltages and the clocks.

##### **Geohot** [[00:50:24](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3024)]
Interesting.

##### **Wozeparrot** [[00:50:24](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3024)]
But that's not what they ship with.

##### **Geohot** [[00:50:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3027)]
I wonder what the stock driver does.

##### **Chrism** [[00:50:30](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3030)]
Yeah.

##### **Geohot** [[00:50:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3032)]
I don't know. You know what I'll do? I'll just test it with HIP and I'll see if I can get the performance with HIP. If I can't get the performance with HIP, then I don't know. We could just like, that is fine. But if I get the performance with HIP, I want to figure out what we're doing differently. But I know like we set, I know that SQTT works on our driver all the time. So I wonder if we're setting some like stable,

##### **Geohot** [[00:51:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3062)]
like stable SID in the power whatever.

##### **Nimlgen** [[00:51:03](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3063)]
Yeah, we enable, we just enable the performance monitoring.

##### **Geohot** [[00:51:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3068)]
I see. But so usually to use performance monitoring on my AMD GPU computer, I have to set stable SID in the power whatever.

##### **Nimlgen** [[00:51:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3079)]
Yeah. Yeah, because actually we have fixed clock for GFX.

##### **Geohot** [[00:51:25](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3085)]
We have a fixed clock.

##### **Nimlgen** [[00:51:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3088)]
Yeah. Yeah.

##### **Chrism** [[00:51:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3089)]
Yeah.

##### **Geohot** [[00:51:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3089)]
Yeah. How do we make it have a boost clock? Um. Actually, I think when I've tested that, so I don't know.

##### **Nimlgen** [[00:51:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3108)]
I mean, yeah, I'll check that. But I think when I've tested that, actually this clock was the highest one AMD GPU ever chosen.

##### **Chrism** [[00:51:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3119)]
Yeah.

##### **Geohot** [[00:52:00](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3120)]
Not a big deal. Lowest priority thing.

##### **Nimlgen** [[00:52:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3125)]
Yeah. And actually for the S team, like noise they made for AMD, actually I got some PR working, but I don't know, like the current implementation just in HTQ, there is some logic to generate a kernel. So just to do a copy. So that's currently located in HTQ. Yeah.

##### **Chrism** [[00:52:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3149)]
Yeah.

##### **Nimlgen** [[00:52:29](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3149)]
So I don't know. I wish it was somewhere in a more higher level, but I don't see any way to implement this easily right now. I mean, basically because we do copies in HTQ is that we have several mapped, I mean, we have like mapped addresses to both CPU and GPU. So that works fine. Yeah. Yeah. Yeah. So we want to use them since that's the only way we can copy like memory views from copying a copy out to the GPU.

##### **Geohot** [[00:53:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3194)]
Yeah.

##### **Geohot** [[00:53:15](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3195)]
Yeah. I don't have an obvious solution there, but yeah, I think it definitely needs to be like, we don't want HTQ to start building kernels. We want to like put it in the render and say like no SDMA available or something. I mean, how about this? Yeah. what if we just like, like just instead of like all detecting it or anything, just have like an SDMA equals zero and that will put it on the renderer. Okay.

##### **Geohot** [[00:53:39](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3219)]
And then like, even if it's a slow path to copy out to the CPU,

##### **Chrism** [[00:53:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3223)]
Yeah.

##### **Geohot** [[00:53:47](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3227)]
Okay. I think in my experience with VMs, you know, here in a few like logical ways, but I've seen like things like using Mind Draper, like create and wiegWievel bugs and things like that.

##### **Chrism** [[00:53:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3231)]
And then, it would be interesting to just like attribute it for like sophistry it like to the CPU.

##### **Geohot** [[00:53:52](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3232)]
I mean, the problem is that, I mean, like currently we use like our function that like hide it for something.

##### **Nimlgen** [[00:53:59](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3239)]
we just in copy in and copy out we have memory views and so because like because of different size of these copies there's there are different kernels to do the copies and i mean either we would have like some additional allocation on this sdmi equals zero path because i like the problem is that this memory view is not mapped to the md gpu and i cannot simply like implement this in realize.py because i mean it would simply pass the memory view to to the program i mean to the md program and i need to deal with that somehow

##### **Geohot** [[00:54:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3291)]
i mean yeah but you can also do it the other way around right like you can do it the other way around like even if it's just stupid even if it does just does mem copy on the cpu if you're going to the cpu i'm fine with that for now just to make the test pass um so like gpu to gpu should be a kernel but gpu to cpu can be a mem copy initiated by the cpu

##### **Nimlgen** [[00:55:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3314)]
that should work right but uh not in this case because it would require like clutch bar

##### **Geohot** [[00:55:22](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3322)]
oh yeah but we require a large bar right

##### **Nimlgen** [[00:55:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3327)]
no because on mic like on mac os we don't have large bar and that would be really slow in usb as well

##### **Geohot** [[00:55:36](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3336)]
yeah but these are edge cases i'm okay with just sdma equals zero just just doing this on a on a normal linux computer if sdm equals zero asserts on usb gpu that's totally fine okay cool yeah let's just make this very simple and make it work really well you can start with about …. work on Linux computers so that we can test in extreme parallel.

##### **Geohot** [[00:56:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3367)]
And yeah, we can even just assert if this is going to serve on small bar. This is a certain simple small bar needs STMA. Next for image D type.

##### **Chrism** [[00:56:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3388)]
Yeah, so faster image equals 1 is merged. So I can find a link to that. But here is.

##### **Geohot** [[00:56:39](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3399)]
Is image equals 1 using the image load stuff? Yes.

##### **Chrism** [[00:56:45](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3405)]
Cool. Yeah. So it's not like that was the thing that happened a little bit ago where we're trying to make that default. It's not default. When you do image equals 1, you get like you don't use the image D type at all in tensor.py. And it's not nearly as fast as image equals 2. I kind of want to have some more profiling tools for Qualcomm before I look into exactly why this is. But my guess is that for one, there's the cache alignment thing, and I think that's a big deal. Then there's another thing, which is that we're not using float 16. Just because if you're going to arbitrarily transform a buffer to say like, OK, now this is an image buffer, then you need the underlying buffer to already be all half precision if you want to be using the.

##### **Geohot** [[00:57:44](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3464)]
Yeah, but we have to fix that. And you have to just use normal float 16 in tensor.py.

##### **Chrism** [[00:57:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3471)]
Yeah, I think that's a good point. Yeah. Yeah. Yeah. I mean, the confusing thing is that all of the math is still happening in float 32. So I didn't really know how to express that.

##### **Geohot** [[00:58:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3481)]
Oh, it's just a cast.

##### **Chrism** [[00:58:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3485)]
I see. And then you have a rewrite rule that detects if float image equals 1 is set.

##### **Geohot** [[00:58:10](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3490)]
No, no, you don't detect if image equals 1 is set. So you can just do this. You can do this in you can express this in normal tinygrad completely image free, right? So if you want to store something in float 16, you do cast float 16 contiguous cast float 32.

##### **Geohot** [[00:58:31](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3511)]
Yeah. Yeah, OK. Yeah, that should just work, right? Yeah.

##### **Chenyu** [[00:58:40](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3520)]
Sometimes your scheduler will create additional kernel for you if you do that. Oh, we got to fix the schedule.

##### **Chrism** [[00:58:48](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3528)]
Yeah. Yeah, that may have been the two extra kernels that we were running into. Although there's. Yeah. For whatever reason, this didn't actually seem to make a big difference in the overall runtime. Yeah.

##### **Geohot** [[00:58:57](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3537)]
So I see now you're at 34 milliseconds with image equals 1 and 16.6 with image equals 2. So yeah, I mean, we have to get the float 16 thing working. Without float 16, it's never going to be fast. But yeah, you should just like.

##### **Chrism** [[00:59:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3551)]
It's even lower. Oh, sorry.

##### **Geohot** [[00:59:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3554)]
If you just do the normal, just make sure you do the. The only thing that has to be done in float 32 is the accumulation.

##### **Chrism** [[00:59:22](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3562)]
Yeah, OK. OK. That yeah. So I bet that can be done. And you're probably right that you can do that in TensorFlow.py.

##### **Geohot** [[00:59:27](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3567)]
Of course. I mean, we already have. We already do this. This is how the BERT trainer works too.

##### **Chrism** [[00:59:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3572)]
OK, I'll take a look at that then. I think there must be. There has to be some sort of rewrite rule though, because you need to be able to express the fact that the loads are doing this automatically for you, right? Like you otherwise. Oh, yeah. Yeah.

##### **Geohot** [[00:59:47](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3587)]
So the fusion of the load and the cast has to be a rewrite role. Yeah.

##### **Chrism** [[00:59:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3591)]
OK. Yeah.

##### **Chenyu** [[00:59:52](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3592)]
OK. All right. BERT is doing this the other way around. We have the weights in float 32 and mass in float 16,

##### **Chenyu** [[01:00:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3601)]
but similar.

##### **Geohot** [[01:00:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3605)]
Oh. OK. Wow, OK.

##### **Geohot** [[01:00:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3608)]
But yeah, I mean, you see the idea, right? You could do the. Like we have a. We have a. Absolutely.

##### **Chenyu** [[01:00:14](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3614)]
You just use contiguous to control a D type you want to store into. Then when you cast it back to float 32, scheduler might have rules that does weird thing. And that's similar to the expand thing that we always want to fix. Yeah.

##### **Geohot** [[01:00:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3632)]
You shouldn't actually even really need contiguous. Like the scheduler should be smart enough to store.

##### **Chenyu** [[01:00:39](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3639)]
We also have a rules or we used to have a rules that look into the path and find a small D type and store in that. Yeah. That's what we want. That's the idea. That's what we want. Yeah.

##### **Chrism** [[01:00:54](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3654)]
So we can do that. Well, yeah, in any case, I don't know. I feel like I tried doing this, but it was a little bit ago. And I do remember there being some sort of weird scheduler effect that made the number of kernels blow up. But.

##### **Chenyu** [[01:01:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3665)]
So I would suggest start with manually contiguous store things in float 16, because we know that's a must. Then if there is a scheduler issue that blow up the kernel count, then we can work on that separately.

##### **Chrism** [[01:01:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3679)]
OK. OK. But anyway. My point was, even if you do image equals two and you don't set float 16, it's still like faster than 34 milliseconds. And I have to imagine this has to do something with. So right now we're effectively only doing 1D indexing. And so then you don't get the benefit of the valid out of bounds stuff.

##### **Geohot** [[01:01:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3703)]
Oh, yeah. No, I mean, that stuff's huge as well. Yeah. So you are going to need some rewrite rules for these image things. You're going to need to be able to express that the load is capable of doing 2D indexing and that the load is capable of doing the cast for you.

##### **Chrism** [[01:01:58](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3718)]
Yeah. Yeah. No, no, for sure.

##### **Geohot** [[01:02:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3721)]
But they're late rewrite rules. That's the key. They're very late. And they should be like on the in the in the in the renderer practically.

##### **Chrism** [[01:02:11](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3731)]
Yeah. I mean, you probably want this like, can you put that in the simplify valid? Because that's that's when you know. Actually, I don't know. I mean, part of the problem is. You can't always perform the like the sort of reshape of the image because you can only have one shape of the image, if that makes any sense.

##### **Chenyu** [[01:02:32](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3752)]
We already go a bit of time already. So I think for these more detailed stuff, I'm very familiar with all the valid simplification stuff. So we can discuss and even better if you have examples that you can show, OK, this generous list code, but image equals to generate that. And we can discuss like where to put these rewriting rules and what simplified rules we can put.

##### **Chrism** [[01:02:57](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3777)]
Yeah, I mean, the code right now, like it literally just generates a one dimensional image, like the the the height, I think, is one and then like the width is, you know, whatever the size of the images. OK.

##### **Geohot** [[01:03:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3792)]
It's yeah, it's a good fallback to have. But yeah, we got to get there. So basically, we got to add in 2D indexing and autocast.

##### **Chrism** [[01:03:19](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3799)]
Yeah, yeah. And then I think they're also. It's quite possibly a thing about that pitch ad as well. I think that also makes a difference. And I'm figuring out how to account for that is not trivial. I think.

##### **Geohot** [[01:03:33](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3813)]
You should probably randomize the orders of these meetings that everybody talks at a random time, not the same time every week. OK.

##### **Chrism** [[01:03:40](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3820)]
Yeah, sorry if we went all over.

##### **Geohot** [[01:03:42](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3822)]
No, no, no, you're good. You're good. We all went on long. I went on long. I went on long.

##### **Chenyu** [[01:03:46](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3826)]
OK. We randomize the order. Let's cut to the meeting. I know we have B1TG here. I saw you update your float8. I would test with your script if it works. I think that one is clean enough. I will review it. But if it works and I review it, then Monty is yours.

##### **Geohot** [[01:04:08](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3848)]
And then I quickly want to talk about the C type structure.

##### **Chrism** [[01:04:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3852)]
Yes, yes. Yeah, so basically, I think I finally have a solution that will end up sort of looking nice and also, it'll look nice to us. It will be a simple implementation. And also, MyPy will find it acceptable, which I think, similar to how data classes work, where you have a decorator on the class, and then it goes through and it looks at the type annotations, I think you should be able to do this for the structures as well. And that should be the cleanest possible way of doing this. And then I will do something similar for the C type. And then I will do something similar for the functions as well, where you can just say, OK, I have this function. And then you just pass the implementation. And then you put a decorator on that. And the decorator looks at the types and looks at the name of the function, and then says, OK, I'll go search in the DLL that you gave me to find the implementation and assign the types properly. I think that's the simplest possible way of doing this. So that's my idea. The other thing is that. I don't know. I was working on this this morning. And I think we don't want to have our own implementation of pointer. And we don't want to have our own implementation of array and our own implementation of, I don't know, there was one other thing. I think this just ends up being super, super complicated. And it feels like you have to code in all these edge cases. And it's especially frustrating because there's extra edge cases because we're still dealing with some C type stuff. So it feels like maybe that's something you want to do eventually if you remove C types altogether. But it doesn't feel like it's warranted to do that yet.

##### **Geohot** [[01:05:54](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3954)]
We do not need to remove C types. The main goals of this are to deal with the Python version issue and to deal with the fact that MyPy doesn't work.

##### **Chrism** [[01:06:05](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3965)]
Yeah. Yeah. So I think the right thing to do here is here.

##### **Geohot** [[01:06:07](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3967)]
We have no interest in removing C types. C types is great. It's built into Python. We love it.

##### **Chrism** [[01:06:12](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3972)]
It's just structure. OK. Yeah. So that makes sense. I think I will. So the correct thing to do is to have the class decorator maybe return a subclass of C type structure or something like that.

##### **Geohot** [[01:06:28](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3988)]
The other key thing is that we shouldn't regress speed. So we shouldn't regress speed on any of these calls.

##### **Chrism** [[01:06:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=3994)]
Yeah. Yeah. That, yeah. I'll benchmark a lot of that stuff and make sure that that's the case. But that should be the case. Yeah.

##### **Geohot** [[01:06:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4003)]
Cool.

##### **Chrism** [[01:06:46](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4006)]
Oh, yeah. The one other thing was we talked about last meeting, refactoring all of the compilers to be part of the renderers. Yep. I'd done a little bit of thinking about that. I haven't started that at all yet. But I had thought about what to do there a little bit. And it feels like a lot of the stuff, you might want to move more stuff into program spec. So for instance, if you look at ops_qcom right now, we have all this. We have a separate way of parsing the neural output and a separate way of parsing the. Yeah. The output of the CL compiler. And this doesn't really seem like what you want to be doing. Instead, it seems like you probably want to pass the flat binary, the image, literally like the binary, like the assembly code. And then you also want to pass some metadata. So like the branch stack and the number of registers and this sort of stuff.

##### **Geohot** [[01:07:43](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4063)]
I think this is independent of the moving the compilers to the renderers.

##### **Chrism** [[01:07:50](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4070)]
Two, take all the folders.

##### **Geohot** [[01:07:51](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4071)]
I recently spent the battery running out ngelos, But then, this CD Twi, smallím, or factors contain, this would probablyisti handle it. It's probablypassing this. And now, I can do some regular functions like parent Gotcha, and I can even just fix new functions and make them better.

##### **Geohot** [[01:08:02](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4082)]
That's kinda cool.

##### **Geohot** [[01:08:04](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4084)]
And for these VMwareating functions, you probably just take all of the recurs on your server, and you were maybe, yeah. Just täcca plenty. it all with rewrite rules.

##### **Chrism** [[01:08:21](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4101)]
Yeah, no, that definitely makes sense.

##### **Geohot** [[01:08:23](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4103)]
And then remove the other path. I just want to remove the other path before we do any..

##### **Chrism** [[01:08:30](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4110)]
And the CC issue. Okay, I'll look at the CC thing as well.

##### **Geohot** [[01:08:34](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4114)]
Yeah, the CC thing. I don't like the CC thing. I think this is gonna be cleaned up, but it should just be.. Yeah. I agree that program spec should probably change, but I think that's completely independent of this, putting the compilers on the renderers and then rewriting OpenCL to be slow. And it gets punished and it's slow because it didn't do a good job of..

##### **Chrism** [[01:08:54](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4134)]
Yeah, yeah, yeah. No, that makes sense. The only reason I had it on my mind is because I had added that auxiliary thing to..

##### **Geohot** [[01:09:01](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4141)]
I saw that. Yeah, it's fine for now. It's fine for now. We can think about what it should be later, but..

##### **Chrism** [[01:09:06](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4146)]
Okay, okay. It'll be easier to do once everything is unified.

##### **Geohot** [[01:09:10](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4150)]
I agree. Cool. That's it for this meeting. Thank you, everyone. Bye-bye. Happy New Year.

##### **Chenyu** [[01:09:26](https://www.youtube.com/watch?v=GNdNtguh1zo&t=4166)]
Happy New Year.
